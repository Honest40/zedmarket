<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZedMarket ðŸ‡¿ðŸ‡²</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial,Helvetica,sans-serif;
  margin:0;
  background:#f2f2f2;
}

header{
  background:linear-gradient(45deg,#0f2a44,#123b63);
  color:#fff;
  padding:15px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}

section{padding:15px}

.hidden{display:none}

.card{
  background:#fff;
  padding:14px;
  margin:15px 0;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
  position:relative;
  transition:.3s;
}

.card:hover{
  transform:translateY(-3px);
  box-shadow:0 15px 30px rgba(0,0,0,.12);
}

.card img{
  width:100%;
  max-height:75vh;
  height:auto;
  object-fit:contain;
  background:#000;
  border-radius:10px;
}

input,select,textarea{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  padding:12px;
  width:100%;
  border:none;
  border-radius:10px;
  font-weight:bold;
  background:linear-gradient(45deg,#198754,#28a745);
  color:#fff;
  cursor:pointer;
  transition:.3s;
}

button:hover{
  transform:scale(1.03);
  opacity:.95;
}

.badge{
  position:absolute;
  top:10px;
  left:10px;
  background:#0d6efd;
  color:#fff;
  padding:5px 10px;
  border-radius:20px;
  font-size:12px;
}

.featured{
  position:absolute;
  top:10px;
  right:10px;
  background:linear-gradient(45deg,#ff9800,#ffc107);
  color:#000;
  padding:5px 10px;
  border-radius:20px;
  font-size:12px;
}

.whatsappBtn{
  display:block;
  margin-top:10px;
  padding:12px;
  text-align:center;
  background:#25D366;
  color:#fff;
  border-radius:8px;
  text-decoration:none;
  font-weight:bold;
}

.whatsappBtn:hover{
  background:#1ebe5d;
}

.chatBox{
  height:220px;
  overflow:auto;
  background:#fafafa;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
  margin-bottom:6px;
}
</style>
</head>

<body>

<header>ZedMarket ðŸ‡¿ðŸ‡² Buy & Sell</header>

<section id="authBox">
  <h3>Login / Register</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button id="loginBtn">Login / Register</button>
</section>

<section id="app" class="hidden">

<h3>ðŸ‘¤ Profile</h3>
<input id="name" placeholder="Your Name">
<input id="phone" placeholder="WhatsApp Number (260...)">
<button id="saveProfile">Save Profile</button>

<h3>âž• Sell Product / Service</h3>
<input id="title" placeholder="Title">
<input id="price" placeholder="Price">
<select id="type">
  <option value="Product">Product</option>
  <option value="Service">Service</option>
</select>
<input id="image" placeholder="Image URL (https://...)">
<textarea id="desc" placeholder="Description"></textarea>
<button id="submitListing">Submit Listing</button>

<h3>ðŸ“¦ My Listings</h3>
<div id="myListings"></div>

<h3>ðŸ›’ Marketplace</h3>
<div id="listings"></div>

<h3>ðŸ’¬ Support Chat</h3>
<div class="chatBox" id="chatBox"></div>
<input id="chatInput" placeholder="Type message...">
<button id="sendMsg">Send</button>

<button onclick="logout()">Logout</button>
</section>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyDhRFgn7nXoZlRf-GX7XakwUYrEMFZDgrI",
  authDomain:"pa-mwera.firebaseapp.com",
  projectId:"pa-mwera",
  storageBucket:"pa-mwera.firebasestorage.app",
  messagingSenderId:"959795010421",
  appId:"1:959795010421:web:84e1cc1517a5d98598113c"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.firestore();

const authBox=document.getElementById("authBox");
const app=document.getElementById("app");

loginBtn.onclick=async()=>{
  try{
    await auth.signInWithEmailAndPassword(email.value,password.value);
  }catch{
    await auth.createUserWithEmailAndPassword(email.value,password.value);
  }
};

auth.onAuthStateChanged(async user=>{
  if(!user) return;
  authBox.classList.add("hidden");
  app.classList.remove("hidden");

  const doc=await db.collection("users").doc(user.uid).get();
  if(doc.exists){
    name.value=doc.data().name||"";
    phone.value=doc.data().phone||"";
  }
  loadListings();
  loadMyListings();
  loadChat();
});

saveProfile.onclick=()=>{
  db.collection("users").doc(auth.currentUser.uid).set({
    name:name.value,
    phone:phone.value,
    verified:false
  },{merge:true});
};

submitListing.onclick=()=>{
  db.collection("listings").add({
    title:title.value,
    price:price.value,
    type:type.value,
    image:image.value,
    desc:desc.value,
    seller:auth.currentUser.uid,
    sellerName:name.value,
    whatsapp:phone.value,
    status:"pending",
    featured:false,
    time:Date.now()
  });
  title.value=price.value=image.value=desc.value="";
};

function loadListings(){
  db.collection("listings").where("status","==","approved")
  .onSnapshot(snap=>{
    listings.innerHTML="";
    snap.forEach(doc=>{
      const d=doc.data();
      listings.innerHTML+=`
      <div class="card">
        ${d.featured?'<div class="featured">SPONSORED</div>':''}
        ${d.sellerVerified?'<div class="badge">VERIFIED</div>':''}
        <img src="${d.image}">
        <h4>${d.title}</h4>
        <p>${d.price} â€¢ ${d.type}</p>
        <p>${d.desc}</p>
        <a class="whatsappBtn" href="https://wa.me/${d.whatsapp}" target="_blank">ðŸ’¬ Chat on WhatsApp</a>
      </div>`;
    });
  });
}

function loadMyListings(){
  db.collection("listings").where("seller","==",auth.currentUser.uid)
  .onSnapshot(snap=>{
    myListings.innerHTML="";
    snap.forEach(doc=>{
      myListings.innerHTML+=`
      <div class="card">
        <h4>${doc.data().title}</h4>
        <p>Status: ${doc.data().status}</p>
        <button onclick="db.collection('listings').doc('${doc.id}').delete()">Delete</button>
      </div>`;
    });
  });
}

function loadChat(){
  const chatId=auth.currentUser.uid;
  db.collection("messages").doc(chatId).collection("messages")
  .orderBy("time")
  .onSnapshot(snap=>{
    chatBox.innerHTML="";
    snap.forEach(m=>{
      chatBox.innerHTML+=`<div><b>${m.data().from}:</b> ${m.data().text}</div>`;
    });
    chatBox.scrollTop=chatBox.scrollHeight;
  });
}

sendMsg.onclick=()=>{
  db.collection("messages").doc(auth.currentUser.uid)
  .collection("messages").add({
    from:"user",
    text:chatInput.value,
    time:Date.now()
  });
  chatInput.value="";
};

function logout(){
  auth.signOut();
  location.reload();
}
</script>

</body>
</html>
