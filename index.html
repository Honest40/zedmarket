<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZedMarket ðŸ‡¿ðŸ‡²</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --blue:#0f2a44;
  --green:#198754;
  --orange:#ff9800;
  --bg:#f4f6f9;
}

body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:var(--bg);
}

header{
  background:linear-gradient(45deg,var(--blue),#1f5fa0);
  color:#fff;
  padding:14px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}

nav{
  display:none;
  background:#fff;
  box-shadow:0 3px 10px rgba(0,0,0,.1);
  position:sticky;
  top:0;
  z-index:10;
}

nav button{
  flex:1;
  padding:12px;
  border:none;
  background:#fff;
  font-weight:bold;
  cursor:pointer;
}

nav button.active{
  border-bottom:4px solid var(--orange);
  color:var(--orange);
}

section{
  display:none;
  padding:15px;
}

section.active{display:block}

.card{
  background:#fff;
  padding:14px;
  margin:15px 0;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
  position:relative;
}

.card img{
  width:100%;
  max-height:75vh;
  object-fit:contain;
  background:#000;
  border-radius:12px;
}

input,select,textarea{
  width:100%;
  padding:11px;
  margin:8px 0;
  border-radius:10px;
  border:1px solid #ccc;
}

button.main{
  width:100%;
  padding:13px;
  border:none;
  border-radius:12px;
  background:linear-gradient(45deg,var(--orange),#ffb74d);
  color:#000;
  font-weight:bold;
  cursor:pointer;
}

.price{
  font-size:22px;
  font-weight:bold;
  color:#fff;
  background:linear-gradient(45deg,var(--green),#2ecc71);
  padding:6px 14px;
  border-radius:20px;
  display:inline-block;
}

.badge{
  position:absolute;
  top:10px;
  padding:5px 12px;
  border-radius:20px;
  font-size:12px;
  font-weight:bold;
}

.verified{left:10px;background:#0d6efd;color:#fff}
.notVerified{left:10px;background:#6c757d;color:#fff}
.sponsored{right:10px;background:linear-gradient(45deg,var(--orange),#ffc107)}

.whatsapp{
  display:block;
  margin-top:12px;
  padding:14px;
  background:#25D366;
  color:#fff;
  text-align:center;
  border-radius:12px;
  text-decoration:none;
  font-weight:bold;
}

.chatBox{
  height:220px;
  overflow:auto;
  background:#fafafa;
  border-radius:10px;
  border:1px solid #ccc;
  padding:10px;
  margin-bottom:8px;
}
</style>
</head>

<body>

<header>ZedMarket ðŸ‡¿ðŸ‡²</header>

<!-- AUTH -->
<section id="auth" class="active">
  <h3>Login / Register</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button class="main" id="loginBtn">Continue</button>
</section>

<!-- NAV -->
<nav id="nav">
  <button data-tab="home" class="active">Home</button>
  <button data-tab="sell">Sell</button>
  <button data-tab="my">My Listings</button>
  <button data-tab="chat">Support</button>
  <button data-tab="profile">Profile</button>
</nav>

<!-- HOME -->
<section id="home">
  <h3>Marketplace</h3>
  <div id="listings"></div>
</section>

<!-- SELL -->
<section id="sell">
  <h3>Post Listing</h3>
  <input id="title" placeholder="Title">
  <input id="price" placeholder="Price (ZMW)">
  <select id="type">
    <option>Product</option>
    <option>Service</option>
  </select>
  <input id="image" placeholder="Image URL (https://...)">
  <textarea id="desc" placeholder="Description"></textarea>
  <button class="main" id="submit">Submit</button>
</section>

<!-- MY LISTINGS -->
<section id="my">
  <h3>My Listings</h3>
  <div id="myListings"></div>
</section>

<!-- CHAT -->
<section id="chat">
  <h3>Support Chat</h3>
  <div class="chatBox" id="chatBox"></div>
  <input id="chatInput" placeholder="Type message">
  <button class="main" id="sendMsg">Send</button>
</section>

<!-- PROFILE -->
<section id="profile">
  <h3>Profile</h3>
  <input id="name" placeholder="Your Name">
  <input id="phone" placeholder="WhatsApp 260...">
  <button class="main" id="saveProfile">Save</button>
  <br><br>
  <button class="main" onclick="logout()">Logout</button>
</section>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDhRFgn7nXoZlRf-GX7XakwUYrEMFZDgrI",
  authDomain:"pa-mwera.firebaseapp.com",
  projectId:"pa-mwera",
  storageBucket:"pa-mwera.firebasestorage.app",
  messagingSenderId:"959795010421",
  appId:"1:959795010421:web:84e1cc1517a5d98598113c"
});

const auth=firebase.auth(), db=firebase.firestore();

loginBtn.onclick=async()=>{
  try{await auth.signInWithEmailAndPassword(email.value,password.value);}
  catch{await auth.createUserWithEmailAndPassword(email.value,password.value);}
};

auth.onAuthStateChanged(async u=>{
  if(!u) return;
  auth.style.display="none";
  nav.style.display="flex";
  showTab("home");

  const d=await db.collection("users").doc(u.uid).get();
  if(d.exists){
    name.value=d.data().name||"";
    phone.value=d.data().phone||"";
  }
  loadHome(); loadMine(); loadChat();
});

document.querySelectorAll("nav button").forEach(b=>{
  b.onclick=()=>showTab(b.dataset.tab);
});

function showTab(t){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(t).classList.add("active");
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  document.querySelector(`[data-tab="${t}"]`).classList.add("active");
}

saveProfile.onclick=()=>{
  db.collection("users").doc(auth.currentUser.uid).set({
    name:name.value,
    phone:phone.value,
    verified:false
  },{merge:true});
};

submit.onclick=()=>{
  db.collection("listings").add({
    title:title.value,price:price.value,type:type.value,
    image:image.value,desc:desc.value,
    seller:auth.currentUser.uid,
    sellerName:name.value,
    sellerVerified:false,
    whatsapp:phone.value,
    status:"pending",
    sponsored:false,
    created:Date.now()
  });
  title.value=price.value=image.value=desc.value="";
};

function loadHome(){
  db.collection("listings").where("status","==","approved")
  .orderBy("created","desc").onSnapshot(s=>{
    listings.innerHTML="";
    s.forEach(d=>{
      const x=d.data();
      listings.innerHTML+=`
      <div class="card">
        <div class="badge ${x.sellerVerified?'verified':'notVerified'}">
          ${x.sellerVerified?'VERIFIED':'NOT VERIFIED'}
        </div>
        ${x.sponsored?'<div class="badge sponsored">SPONSORED</div>':''}
        <img src="${x.image}">
        <h3>${x.title}</h3>
        <div class="price">ZMW ${x.price}</div>
        <p>${x.desc}</p>
        <a class="whatsapp" href="https://wa.me/${x.whatsapp}" target="_blank">
          ðŸ’¬ WhatsApp Seller
        </a>
      </div>`;
    });
  });
}

function loadMine(){
  db.collection("listings").where("seller","==",auth.currentUser.uid)
  .onSnapshot(s=>{
    myListings.innerHTML="";
    s.forEach(d=>{
      myListings.innerHTML+=`
      <div class="card">
        <h4>${d.data().title}</h4>
        <div class="price">ZMW ${d.data().price}</div>
        <p>Status: ${d.data().status}</p>
        <button class="main" onclick="db.collection('listings').doc('${d.id}').delete()">Delete</button>
      </div>`;
    });
  });
}

function loadChat(){
  db.collection("messages").doc(auth.currentUser.uid)
  .collection("messages").orderBy("time")
  .onSnapshot(s=>{
    chatBox.innerHTML="";
    s.forEach(m=>{
      chatBox.innerHTML+=`<div><b>${m.data().from}:</b> ${m.data().text}</div>`;
    });
    chatBox.scrollTop=chatBox.scrollHeight;
  });
}

sendMsg.onclick=()=>{
  db.collection("messages").doc(auth.currentUser.uid)
  .collection("messages").add({
    from:"user",text:chatInput.value,time:Date.now()
  });
  chatInput.value="";
};

function logout(){auth.signOut();location.reload();}
</script>

</body>
</html>
